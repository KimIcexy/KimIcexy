<!DOCTYPE html>
<html>
<head>
  <title>Web App Chỉnh sửa ảnh</title>
  <style>
    #canvas {
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <input type="file" id="imageInput">
  <canvas id="canvas"></canvas>
  <script>
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var img = new Image();
    var croppedImages = []; // Mảng lưu trữ các ảnh đã cắt
  
    // Biến lưu trữ tọa độ khung cắt
    var startX, startY, endX, endY;
    var isDragging = false;
  
    // Sự kiện khi chuột được nhấn xuống trên canvas
    canvas.addEventListener('mousedown', function(e) {
      startX = e.offsetX;
      startY = e.offsetY;
      isDragging = true;
    });
  
    // Sự kiện khi chuột được di chuyển trên canvas
    canvas.addEventListener('mousemove', function(e) {
      if (isDragging) {
        drawCropRect(startX, startY, e.offsetX, e.offsetY);
      }
    });
  
    // Sự kiện khi chuột được nhấc lên trên canvas
    canvas.addEventListener('mouseup', function(e) {
      if (isDragging) {
        isDragging = false;
        endX = e.offsetX;
        endY = e.offsetY;
        drawCropRect(startX, startY, endX, endY);
        cropImage(startX, startY, endX, endY);
      }
    });
  
    // Hàm vẽ khung cắt trên canvas
    function drawCropRect(x1, y1, x2, y2) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#ff0000';
      ctx.lineWidth = 2;
      ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
    }
  
    // Hàm cắt ảnh dựa trên khung đã vẽ
    function cropImage(x1, y1, x2, y2) {
      var croppedWidth = x2 - x1;
      var croppedHeight = y2 - y1;
      var croppedData = ctx.getImageData(x1, y1, croppedWidth, croppedHeight);
  
      // Đưa ảnh đã cắt vào canvas mới
      var newCanvas = document.createElement('canvas');
      var newCtx = newCanvas.getContext('2d');
      newCanvas.width = croppedWidth;
      newCanvas.height = croppedHeight;
      newCtx.putImageData(croppedData, 0, 0);
  
      // Lưu ảnh đã cắt vào mảng croppedImages
      croppedImages.push(newCanvas.toDataURL("image/png"));
  
      // Hiển thị ảnh đã cắt trong canvas ban đầu
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(newCanvas, x1, y1, croppedWidth, croppedHeight);
    }

// Sự kiện khi người dùng chọn ảnh
imageInput.addEventListener('change', function(e) {
  var file = e.target.files[0];
  var reader = new FileReader();
  reader.onload = function(event) {
    img.onload = function() {
      // Đưa ảnh về kích thước phù hợp với khung hình
      var maxDimension = Math.max(canvas.width, canvas.height);
      var scaleFactor = maxDimension / Math.max(img.width, img.height);
      var newWidth = img.width * scaleFactor;
      var newHeight = img.height * scaleFactor;
      canvas.width = newWidth;
      canvas.height = newHeight;

      // Vẽ ảnh đã chỉnh kích thước lên canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0, newWidth, newHeight);

      // Xóa các ảnh đã cắt trước đó
      croppedImages = [];
    };
    img.src = event.target.result;
  };
  reader.readAsDataURL(file);
});
  </script>
</body>
</html>